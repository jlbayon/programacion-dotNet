# ‚úÖ Validadores (*Validators*) en ASP.NET Web Forms

Los **validators** (controles de validaci√≥n) en ASP.NET se utilizan para **comprobar autom√°ticamente que los datos introducidos por el usuario sean correctos** antes de enviarse al servidor.  
Permiten aplicar reglas de validaci√≥n sin necesidad de escribir mucho c√≥digo, y pueden funcionar tanto en el **cliente (navegador)** como en el **servidor**.

---

## üß© ¬øPara qu√© sirven los *validators*?

Sirven para:
- Asegurarse de que un campo obligatorio no quede vac√≠o.  
- Comprobar que un dato tenga el **formato correcto** (por ejemplo, un correo electr√≥nico).  
- Verificar que un valor est√© dentro de un **rango num√©rico o de fechas**.  
- Comparar dos campos (por ejemplo, contrase√±a y repetir contrase√±a).  
- Crear reglas de validaci√≥n personalizadas.  

---

## ‚öôÔ∏è Tipos de validadores en ASP.NET

| Control | Funci√≥n principal |
|----------|------------------|
| **RequiredFieldValidator** | Verifica que el campo no est√© vac√≠o. |
| **CompareValidator** | Compara el valor de un control con otro o con un valor fijo. |
| **RangeValidator** | Comprueba que el valor est√© dentro de un rango (num√©rico, de fechas o de texto). |
| **RegularExpressionValidator** | Comprueba que el valor cumpla una expresi√≥n regular (por ejemplo, formato de correo o tel√©fono). |
| **CustomValidator** | Permite definir validaciones personalizadas mediante c√≥digo (en C# o JavaScript). |
| **ValidationSummary** | Muestra un resumen con todos los mensajes de error del formulario. |

---

## üîπ Propiedades principales

| Propiedad                      | Descripci√≥n                                                      |
| ------------------------------ | ---------------------------------------------------------------- |
| **`ControlToValidate`**        | El control asociado (por ejemplo, un `TextBox`).                 |
| **`ErrorMessage`**             | Mensaje de error que se muestra si la validaci√≥n falla.          |
| **`OnServerValidate`**         | Nombre del m√©todo en el **c√≥digo del servidor (C#)** que valida. |
| **`ClientValidationFunction`** | Nombre de la funci√≥n **JavaScript** que valida en el cliente.    |
| **`Display`**                  | C√≥mo se muestra el mensaje (`Static` se muestre o no, se asigna espacio para el mensaje, `Dynamic` solo ocupa espacio el mensaje cuando se muestra, `None` no se muestra el mensaje).        |

---

## üß† Funcionamiento

- Cada *validator* est√° vinculado a un control mediante el atributo **`ControlToValidate`**.  
- Cuando el usuario pulsa el bot√≥n **Enviar**, ASP.NET comprueba todas las reglas de validaci√≥n.  
- Si alguna no se cumple:
  - Se muestra el mensaje de error.  
  - No se ejecuta el c√≥digo del servidor (si usas `Page.IsValid`).  
---

### 1. üü¢ RequiredFieldValidator

**Funci√≥n:** Verifica que el campo no est√© vac√≠o.

```asp
<asp:RequiredFieldValidator 
    ControlToValidate="txtNombre"
    ErrorMessage="El nombre es obligatorio."
    Display="Dynamic"
    runat="server" />
```

- ‚úÖ Se usa para campos obligatorios como nombre, correo, etc.
- ‚ùå Si el campo est√° vac√≠o, el formulario no se env√≠a.

---

### 2. üî¢ RangeValidator

**Funci√≥n:** Comprueba que el valor est√© dentro de un rango definido.

```asp
<asp:RangeValidator 
    ControlToValidate="txtEdad"
    MinimumValue="18"
    MaximumValue="60"
    Type="Integer"
    ErrorMessage="La edad debe estar entre 18 y 60 a√±os."
    runat="server" />
```

- Soporta tipos: `Integer`, `Double`, `Date`, `String`.

---

### 3. üîÅ CompareValidator

**Funci√≥n:** Compara el valor de un control con otro o con un valor fijo.

```asp
<asp:CompareValidator 
    ControlToValidate="txtConfirmar"
    ControlToCompare="txtClave"
    ErrorMessage="Las contrase√±as no coinciden."
    Operator="Equal"
    Type="String"
    runat="server" />
```

- Operadores disponibles: `Equal`, `NotEqual`, `GreaterThan`, `LessThan`, `GreaterThanEqual`, `LessThanEqual`.

---

### 4. üî° RegularExpressionValidator

**Funci√≥n:** Valida un valor usando una expresi√≥n regular (regex).

```asp
<asp:RegularExpressionValidator 
    ControlToValidate="txtEmail"
    ValidationExpression="\w+@\w+\.\w+"
    ErrorMessage="Ingrese un correo electr√≥nico v√°lido."
    runat="server" />
```

- Permite validar formatos como email, tel√©fono, c√≥digo postal, etc.

---

### 5. ‚öôÔ∏è CustomValidator

**Funci√≥n:** Permite definir reglas de validaci√≥n personalizadas cuando las reglas est√°ndar (como `RequiredFieldValidator` o `RangeValidator`) no son suficientes.
Puedes usarlo para verificar cualquier condici√≥n l√≥gica que t√∫ definas, **tanto en el cliente (JavaScript)** como **en el servidor (C#)**.
```asp
<asp:CustomValidator 
    ControlToValidate="txtEdad"
    ErrorMessage="Debe ser mayor o igual a 18 a√±os."
    OnServerValidate="cvEdad_ServerValidate"
    ClientValidationFunction="validarEdadCliente"
    runat="server" />
```

- Valida en el **cliente (JavaScript)** y/o **servidor (C#)**.
- Puede validar **m√°s de un control** (en cuyo caso no usamos `ControlToValidate`).

#### üîπ Validaci√≥n del lado del **servidor**

En el **code-behind (C#)** defines el m√©todo que ejecuta la l√≥gica personalizada:

```csharp
protected void cvPersonalizado_ServerValidate(object source, ServerValidateEventArgs args)
{
    int edad;
    args.IsValid = false;

    // Intenta convertir el texto a n√∫mero
    if (int.TryParse(args.Value, out edad))
    {   // Regla personalizada
        args.IsValid = edad >= 18;
    }
}
```

* **`args.Value`** ‚Üí contiene el valor del control a validar.
* **`args.IsValid`** ‚Üí debes establecerlo a `true` o `false` seg√∫n la regla.

---

#### üîπ Validaci√≥n del lado del **cliente (JavaScript)**

Tambi√©n puedes validar antes de enviar al servidor, lo que mejora la experiencia del usuario:

```html
<script type="text/javascript">
    function validarEdadCliente(source, args) {
        var edad = parseInt(args.Value);
        args.IsValid = !isNaN(edad) && edad >= 18;
    }
</script>
```

* **`args.Value`** ‚Üí valor del campo.
* **`args.IsValid`** ‚Üí debe quedar en `true` o `false`.

> üí° Si la validaci√≥n del cliente falla, **el formulario no se env√≠a** al servidor.

---

### üîπ Ejemplo completo

```asp
<asp:TextBox ID="txtEdad" runat="server"></asp:TextBox>

<asp:CustomValidator 
    ID="cvEdad" 
    ControlToValidate="txtEdad"
    ErrorMessage="Debe ingresar una edad v√°lida (mayor o igual a 18)."
    OnServerValidate="cvEdad_ServerValidate"
    ClientValidationFunction="validarEdadCliente"
    Display="Dynamic"
    runat="server" />

<asp:Button ID="btnEnviar" Text="Enviar" runat="server" OnClick="btnEnviar_Click" />
<asp:ValidationSummary runat="server" />
```

#### C√≥digo detr√°s (C#):

```csharp
protected void cvEdad_ServerValidate(object source, ServerValidateEventArgs args)
{
    int edad;
    args.IsValid = int.TryParse(args.Value, out edad) && edad >= 18;
}

protected void btnEnviar_Click(object sender, EventArgs e)
{
    if (Page.IsValid)
    {
        // Procesar datos v√°lidos
    }
}
```

---

### 6. üßÆ ValidationSummary

**Funci√≥n:** No valida, pero muestra todos los mensajes de error de la p√°gina.

```asp
<asp:ValidationSummary 
    HeaderText="Por favor corrige los siguientes errores:"
    ShowMessageBox="False"
    ShowSummary="True"
    runat="server" />
```

- Agrupa los mensajes de los validadores.
- Puede mostrarse como lista o cuadro emergente (`ShowMessageBox="True"`).

---

### 7. ‚öôÔ∏è CustomValidator (validando dos controles)

Ejemplo: validar que la **fecha de fin** sea **mayor o igual** a la **fecha de inicio**.

### ASPX
```asp
<asp:TextBox ID="txtFechaInicio" runat="server"></asp:TextBox>
<asp:TextBox ID="txtFechaFin" runat="server"></asp:TextBox>

<asp:CustomValidator 
    ID="cvFechas" 
    ErrorMessage="La fecha de fin debe ser igual o posterior a la fecha de inicio."
    OnServerValidate="cvFechas_ServerValidate"
    ClientValidationFunction="validarFechasCliente"
    Display="Dynamic"
    runat="server" />

<asp:Button ID="btnEnviar" runat="server" Text="Enviar" OnClick="btnEnviar_Click" />
<asp:ValidationSummary runat="server" HeaderText="Errores encontrados:" />
```

### C# Code-behind
```csharp
protected void cvFechas_ServerValidate(object source, ServerValidateEventArgs args)
{
    DateTime fechaInicio, fechaFin;
    bool inicioOk = DateTime.TryParse(txtFechaInicio.Text, out fechaInicio);
    bool finOk = DateTime.TryParse(txtFechaFin.Text, out fechaFin);

    if (inicioOk && finOk)
        args.IsValid = fechaFin >= fechaInicio;
    else
        args.IsValid = false;
}
```

### JavaScript (cliente)
```html
<script type="text/javascript">
function validarFechasCliente(source, args) {
    var inicio = document.getElementById('<%= txtFechaInicio.ClientID %>').value;
    var fin = document.getElementById('<%= txtFechaFin.ClientID %>').value;

    if (inicio && fin) {
        var fechaInicio = new Date(inicio);
        var fechaFin = new Date(fin);
        args.IsValid = fechaFin >= fechaInicio;
    } else {
        args.IsValid = false;
    }
}
</script>
```

---

## üß≠ Resumen general

| Validador | Prop√≥sito | Ejemplo com√∫n |
|------------|------------|----------------|
| **RequiredFieldValidator** | Campo obligatorio | Nombre, correo |
| **RangeValidator** | Rango de valores | Edad, precio |
| **CompareValidator** | Comparar con otro valor | Confirmar contrase√±a |
| **RegularExpressionValidator** | Patr√≥n de texto | Email, tel√©fono |
| **CustomValidator** | Regla personalizada | Validar dos fechas |
| **ValidationSummary** | Mostrar errores | Lista o cuadro emergente |

---

‚úÖ **Conclusi√≥n:**  
Los validadores en ASP.NET facilitan la verificaci√≥n de datos en formularios, mejorando la experiencia del usuario y la seguridad del sistema.  
Usar validaci√≥n en el **cliente** mejora la rapidez, y en el **servidor** garantiza la integridad de los datos.

---

## üîí Validaci√≥n en cliente y en servidor

ASP.NET realiza validaci√≥n **en ambos lados**:
- **Cliente (navegador):** evita recargar la p√°gina innecesariamente.  
- **Servidor:** garantiza la seguridad (el usuario no puede saltarse la validaci√≥n).  

En el c√≥digo del servidor, puedes comprobarlo as√≠:

```csharp
protected void BtnEnviar_Click(object sender, EventArgs e)
{
    if (Page.IsValid)
    {
        // Solo se ejecuta si todas las validaciones son correctas
        Response.Write("Datos correctos ‚úÖ");
    }
}
```

---

## ‚úÖ Ventajas

- Muy f√°ciles de usar.  
- Integrados con el ciclo de vida de ASP.NET.   
- Permiten validaci√≥n visual inmediata al usuario.  

---

> üí° **Conclusi√≥n:**  
> Los *validators* de ASP.NET Web Forms son herramientas muy potentes para asegurar la calidad de los datos introducidos por los usuarios.  
> Permiten validar informaci√≥n de forma sencilla y segura, combinando la validaci√≥n del lado del cliente y del servidor.

# üîç Por qu√© los *Validators* de ASP.NET validan en cliente y en servidor

En ASP.NET Web Forms, los **controles de validaci√≥n** realizan la comprobaci√≥n de los datos **tanto en el cliente (navegador)** como en el **servidor (IIS/ASP.NET)**.  
Esta validaci√≥n dual combina **rapidez** y **seguridad**, ofreciendo una mejor experiencia al usuario y garantizando la integridad de los datos.

---

## ‚öôÔ∏è 1. Validaci√≥n en el cliente (navegador)

Cuando se usa un control como este:

```aspx
<asp:RequiredFieldValidator ID="ReqNombre" runat="server"
    ControlToValidate="TxtNombre"
    ErrorMessage="El nombre es obligatorio."
    ForeColor="Red" Display="Dynamic" />
```

ASP.NET genera **autom√°ticamente c√≥digo JavaScript** al renderizar la p√°gina.  
Ese c√≥digo:

- Detecta cu√°ndo el usuario intenta enviar el formulario (`onsubmit`).
- Comprueba que el campo `TxtNombre` no est√© vac√≠o.
- Si no se cumple la condici√≥n, **muestra el mensaje de error sin recargar la p√°gina** y **bloquea el env√≠o**.

üëâ Ventajas de la validaci√≥n en cliente:
- Respuesta inmediata al usuario.  
- Evita recargar la p√°gina.  
- Reduce peticiones innecesarias al servidor.  

üí° Se conoce como **validaci√≥n del lado del cliente**.

---

## üñ•Ô∏è 2. Validaci√≥n en el servidor

Aunque el navegador ya haya validado los datos, ASP.NET **vuelve a validar en el servidor** cuando el formulario llega a procesarse.  
Esta validaci√≥n se ejecuta en el ciclo de vida de la p√°gina, **antes de ejecutar cualquier evento** como `Page_Load` o `BtnEnviar_Click`.

ASP.NET eval√∫a de nuevo todos los validadores y actualiza la propiedad:

```csharp
Page.IsValid
```

- `true` ‚Üí todos los controles pasan la validaci√≥n.  
- `false` ‚Üí alguno de los validadores ha fallado.

Ejemplo:

```csharp
protected void BtnEnviar_Click(object sender, EventArgs e)
{
    if (Page.IsValid)
    {
        // Solo se ejecuta si todos los validadores son correctos
        GuardarDatos();
    }
}
```

---

## üîí 3. ¬øPor qu√© validar dos veces?

Porque **no se puede confiar completamente en el cliente**.  
Cualquier usuario podr√≠a:
- Desactivar JavaScript.  
- Modificar el HTML con herramientas del navegador.  
- Enviar datos falsos con herramientas externas (Postman, scripts, etc.).  

Por eso, aunque la validaci√≥n del cliente mejora la **usabilidad**, la del **servidor** garantiza la **seguridad** y la **consistencia**.

---

## üß© 4. Comparativa entre validaciones

| Aspecto | Validaci√≥n en cliente | Validaci√≥n en servidor |
|----------|----------------------|------------------------|
| **D√≥nde se ejecuta** | En el navegador (JavaScript) | En el servidor (ASP.NET/IIS) |
| **Velocidad** | Muy r√°pida, sin recargar la p√°gina | M√°s lenta, requiere env√≠o del formulario |
| **Objetivo** | Mejorar la experiencia del usuario | Proteger y verificar los datos recibidos |
| **Depende del usuario** | S√≠, puede desactivarse (sin JS) | No, siempre se ejecuta |
| **Requiere conexi√≥n** | No | S√≠ |
| **Resultado visible** | Mensajes inmediatos | Respuestas o errores del servidor |

---

## ‚úÖ Conclusi√≥n

ASP.NET Web Forms **valida en ambos lados** para ofrecer lo mejor de cada enfoque:

- üí® **Rapidez** ‚Üí validaci√≥n en el cliente (JavaScript).  
- üîí **Seguridad y fiabilidad** ‚Üí validaci√≥n en el servidor (ASP.NET).  

De esta manera, aunque el usuario manipule el formulario o desactive JavaScript, el servidor **nunca procesar√° datos inv√°lidos o peligrosos**.

---

> üß† **Resumen:**  
> La validaci√≥n en el cliente mejora la experiencia del usuario,  
> mientras que la validaci√≥n en el servidor protege la aplicaci√≥n y garantiza la integridad de los datos.
